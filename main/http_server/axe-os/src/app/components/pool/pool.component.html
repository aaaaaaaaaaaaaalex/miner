<div class="grid">
    <div class="col-12">
        <div class="card">
            <h2>Pool Configuration</h2>
            <form [formGroup]="form" *ngIf="form != null">
        <div class="field grid p-fluid">
            <label htmlFor="stratumURL" class="col-12 mb-2 md:col-2 md:mb-0">Stratum Host:</label>
            <div class="col-12 md:col-10">
                <input pInputText id="stratumURL" type="text" formControlName="stratumURL" />
                <div>
                    <small>Do not include 'stratum+tcp://' or port.</small>
                </div>
            </div>
        </div>
        <div class="field grid p-fluid">
            <label htmlFor="stratumPort" class="col-12 mb-2 md:col-2 md:mb-0">Stratum Port:</label>
            <div class="col-12 md:col-10">
                <input pInputText id="stratumPort" formControlName="stratumPort" type="number" />
            </div>
        </div>
        <div class="field grid p-fluid">
            <label htmlFor="stratumTLS" class="col-12 mb-2 md:col-2 md:mb-0">Stratum TLS:</label>
            <div class="col-12 md:col-10">
                <div class="flex flex-wrap gap-3">
                    <div class="field-radiobutton mb-0">
                        <p-radioButton name="stratumTLS" [value]="0" formControlName="stratumTLS" inputId="stratumTLS_0"></p-radioButton>
                        <label for="stratumTLS_0" class="ml-2">Disable</label>
                    </div>
                    <div class="field-radiobutton mb-0">
                        <p-radioButton name="stratumTLS" [value]="1" formControlName="stratumTLS" inputId="stratumTLS_1"></p-radioButton>
                        <label for="stratumTLS_1" class="ml-2">Bundled CA</label>
                    </div>
                    <div class="field-radiobutton mb-0">
                        <p-radioButton name="stratumTLS" [value]="2" formControlName="stratumTLS" inputId="stratumTLS_2"></p-radioButton>
                        <label for="stratumTLS_2" class="ml-2">Custom CA</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="field grid p-fluid" *ngIf="form.get('stratumTLS')?.value === 2">
            <label htmlFor="stratumCert" class="col-12 mb-2 md:col-2 md:mb-0">Stratum Certificate:</label>
            <div class="col-12 md:col-10">
                <div class="p-inputgroup">
                    <textarea pInputTextarea id="stratumCert" formControlName="stratumCert" rows="5"
                        placeholder="Enter SSL/TLS certificate or choose a certificate file" 
                        style="font-family: monospace;"></textarea>
                    <span class="p-inputgroup-addon">
                        <button pButton type="button" icon="pi pi-upload" class="p-button-secondary" 
                            (click)="stratumCertFileInput.click()"></button>
                        <input #stratumCertFileInput type="file" (change)="onCertFileSelected($event, 'stratumCert')" 
                            style="display:none" accept=".pem,.crt,.cer">
                    </span>
                </div>
                <small>Enter or <a href="#" (click)="$event.preventDefault(); stratumCertFileInput.click()">choose a certificate file</a> (.pem, .crt, .cer)</small>
                <div>
                    <small class="p-error" *ngIf="form.get('stratumCert')?.errors?.['invalidCertificate']">
                        Please enter a valid SSL/TLS certificate
                    </small>
                </div>
            </div>
        </div>
        <div class="field grid p-fluid">
            <label htmlFor="stratumUser" class="col-12 mb-2 md:col-2 md:mb-0">Stratum User:</label>
            <div class="col-12 md:col-10">
                <input pInputText id="stratumUser" formControlName="stratumUser" type="text" />
            </div>
        </div>
        <div class="field grid p-fluid">
            <label htmlFor="stratumPassword" class="col-12 mb-2 md:col-2 md:mb-0">Stratum Password:</label>
            <div class="col-12 md:col-10 p-input-icon-right">
                <i *ngIf="form.get('stratumPassword')?.dirty" class="pi"
                   [ngClass]="{'pi-eye': !showStratumPassword, 'pi-eye-slash': showStratumPassword}"
                   (click)="toggleStratumPasswordVisibility()" style="cursor: pointer;"></i>
                <input pInputText id="stratumPassword" formControlName="stratumPassword"
                       [type]="showStratumPassword ? 'text' : 'password'"
                       placeholder="Enter stratum password" />
            </div>
        </div>
        <div class="field grid p-fluid">
            <label htmlFor="fallbackStratumURL" class="col-12 mb-2 md:col-2 md:mb-0">Fallback Stratum Host:</label>
            <div class="col-12 md:col-10">
                <input pInputText id="fallbackStratumURL" type="text" formControlName="fallbackStratumURL" />
                <div>
                    <small>Do not include 'stratum+tcp://' or port.</small>
                </div>
            </div>
        </div>
        <div class="field grid p-fluid">
            <label htmlFor="fallbackStratumPort" class="col-12 mb-2 md:col-2 md:mb-0">Fallback Stratum Port:</label>
            <div class="col-12 md:col-10">
                <input pInputText id="fallbackStratumPort" formControlName="fallbackStratumPort" type="number" />
            </div>
        </div>
        <div class="field grid p-fluid">
            <label htmlFor="fallbackStratumTLS" class="col-12 mb-2 md:col-2 md:mb-0">Fallback Stratum TLS:</label>
            <div class="col-12 md:col-10">
                <div class="flex flex-wrap gap-3">
                    <div class="field-radiobutton mb-0">
                        <p-radioButton name="fallbackStratumTLS" [value]="0" formControlName="fallbackStratumTLS" inputId="fallbackStratumTLS_0"></p-radioButton>
                        <label for="fallbackStratumTLS_0" class="ml-2">Disable</label>
                    </div>
                    <div class="field-radiobutton mb-0">
                        <p-radioButton name="fallbackStratumTLS" [value]="1" formControlName="fallbackStratumTLS" inputId="fallbackStratumTLS_1"></p-radioButton>
                        <label for="fallbackStratumTLS_1" class="ml-2">Bundled CA</label>
                    </div>
                    <div class="field-radiobutton mb-0">
                        <p-radioButton name="fallbackStratumTLS" [value]="2" formControlName="fallbackStratumTLS" inputId="fallbackStratumTLS_2"></p-radioButton>
                        <label for="fallbackStratumTLS_2" class="ml-2">Custom CA</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="field grid p-fluid" *ngIf="form.get('fallbackStratumTLS')?.value === 2">
            <label htmlFor="fallbackStratumCert" class="col-12 mb-2 md:col-2 md:mb-0">Fallback Stratum Certificate:</label>
            <div class="col-12 md:col-10">
                <div class="p-inputgroup">
                    <textarea pInputTextarea id="fallbackStratumCert" formControlName="fallbackStratumCert" rows="5"
                        placeholder="Enter SSL/TLS certificate or choose a certificate file"
                        style="font-family: monospace;"></textarea>
                    <span class="p-inputgroup-addon">
                        <button pButton type="button" icon="pi pi-upload" class="p-button-secondary" 
                            (click)="fallbackStratumCertFileInput.click()"></button>
                        <input #fallbackStratumCertFileInput type="file" (change)="onCertFileSelected($event, 'fallbackStratumCert')" 
                            style="display:none" accept=".pem,.crt,.cer">
                    </span>
                </div>
                <small>Enter or <a href="#" (click)="$event.preventDefault(); fallbackStratumCertFileInput.click()">choose a certificate file</a> (.pem, .crt, .cer)</small>
                <div>
                    <small class="p-error" *ngIf="form.get('fallbackStratumCert')?.errors?.['invalidCertificate']">
                        Please enter a valid SSL/TLS certificate
                    </small>
                </div>
            </div>
        </div>
        <div class="field grid p-fluid">
            <label htmlFor="fallbackStratumUser" class="col-12 mb-2 md:col-2 md:mb-0">Fallback Stratum User:</label>
            <div class="col-12 md:col-10">
                <input pInputText id="fallbackStratumUser" formControlName="fallbackStratumUser" type="text" />
            </div>
        </div>
        <div class="field grid p-fluid">
            <label htmlFor="fallbackStratumPassword" class="col-12 mb-2 md:col-2 md:mb-0">Fallback Stratum Password:</label>
            <div class="col-12 md:col-10 p-input-icon-right">
                <i *ngIf="form.get('fallbackStratumPassword')?.dirty" class="pi"
                   [ngClass]="{'pi-eye': !showFallbackStratumPassword, 'pi-eye-slash': showFallbackStratumPassword}"
                   (click)="toggleFallbackStratumPasswordVisibility()" style="cursor: pointer;"></i>
                <input pInputText id="fallbackStratumPassword" formControlName="fallbackStratumPassword"
                       [type]="showFallbackStratumPassword ? 'text' : 'password'"
                       placeholder="Enter fallback stratum password" />
            </div>
        </div>

        <div class="mt-2">
            <button pButton [disabled]="!form.dirty || form.invalid" (click)="updateSystem()"
                class="btn btn-primary mr-2">Save</button>
            <b style="line-height: 34px;">You must restart this device after saving for changes to take effect.</b>
        </div>

        <div class="mt-2">
          <button pButton [disabled]="!savedChanges" (click)="restart()">Restart</button>
        </div>
            </form>
        </div>
    </div>
</div>
